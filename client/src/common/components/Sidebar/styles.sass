@use "@/common/styles/colors"

$mobile: 768px

.sidebar
  width: 5rem
  user-select: none
  background-color: colors.$lighter-background
  height: 100%
  display: flex
  flex-direction: column
  align-items: center
  border-right: 2px solid colors.$dark-gray
  overflow: visible
  transition: margin-left 0.2s, box-shadow 0.2s
  left: 0
  top: 0
  z-index: 10

  @supports (-webkit-touch-callout: none)
    height: 100dvh
    height: -webkit-fill-available

  @media (max-width: $mobile)
    display: none

  &.collapsed
    margin-left: -5rem
    position: absolute
    top: var(--title-bar-height)
    height: var(--content-height)

    &:hover
      margin-left: 0
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2)

  .sidebar-top
    display: flex
    flex-direction: column
    align-items: center
    flex: 1
    overflow-y: auto
    width: 100%

  .sidebar-logo
    margin-top: 1rem
    width: 3rem
    height: 3rem
    cursor: pointer
    display: flex
    justify-content: center
    align-items: center

  hr
    background-color: colors.$dark-gray
    width: 50%
    margin: 1rem 0
    border: none
    height: 2px
    border-radius: 1rem

  nav
    display: flex
    flex-direction: column
    gap: 1rem
    overflow-y: auto
    flex: 1
    align-items: center
    width: 100%
    scrollbar-width: none
    -ms-overflow-style: none

    &::-webkit-scrollbar
      display: none

    .nav-item
      width: 3.75rem
      height: 3.75rem
      flex-shrink: 0
      display: flex
      justify-content: center
      align-items: center
      color: colors.$white
      border: 1px solid transparent
      border-radius: 1rem
      transition: all 0.2s
      cursor: pointer

      svg
        width: 2.5rem
        height: 2.5rem

      &:hover:not(.nav-item-disabled)
        color: colors.$primary

      &.nav-item-active
        background-color: colors.$dark-gray
        border: 1px solid colors.$gray
        color: colors.$primary

      &.nav-item-disabled
        opacity: 0.5
        cursor: not-allowed

  .sidebar-bottom
    display: flex
    flex-direction: column
    align-items: center
    flex-shrink: 0
    padding: 0.5rem
    width: 100%
    box-sizing: border-box

  .user-account-area
    position: relative
    width: 100%
    display: flex
    flex-direction: column
    align-items: center

  .user-btn
    width: 3.75rem
    height: 3.75rem
    flex-shrink: 0
    display: flex
    justify-content: center
    align-items: center
    color: colors.$white
    border: 1px solid transparent
    border-radius: 1rem
    transition: all 0.2s
    cursor: pointer

    svg
      width: 2.5rem
      height: 2.5rem

    &:hover
      color: colors.$primary

    &.active
      background-color: colors.$dark-gray
      border: 1px solid colors.$gray
      color: colors.$primary

  .user-menu
    position: absolute
    bottom: calc(100% + 0.5rem)
    left: 0.5rem
    background-color: colors.$lighter-background
    border: 1px solid colors.$dark-gray
    border-radius: 0.75rem
    padding: 0.375rem
    min-width: 200px
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.3)
    opacity: 0
    transform: scale(0.95) translateY(8px)
    transition: opacity 0.12s cubic-bezier(0.4, 0, 0.2, 1), transform 0.12s cubic-bezier(0.4, 0, 0.2, 1)
    pointer-events: none
    z-index: 100

    &.open
      opacity: 1
      transform: scale(1) translateY(0)
      pointer-events: auto

  .user-menu-header
    display: flex
    align-items: center
    gap: 0.625rem
    padding: 0.625rem 0.75rem

    .user-avatar
      width: 2.25rem
      height: 2.25rem
      border-radius: 0.5rem
      background-color: colors.$gray
      display: flex
      align-items: center
      justify-content: center
      flex-shrink: 0

      span
        color: colors.$white
        font-size: 0.75rem
        font-weight: 700
        letter-spacing: 0.02em

    .user-info
      flex: 1
      display: flex
      flex-direction: column
      gap: 0.125rem
      min-width: 0

      .user-name
        color: colors.$white
        font-size: 0.875rem
        font-weight: 600
        white-space: nowrap
        overflow: hidden
        text-overflow: ellipsis

      .user-username
        color: colors.$subtext
        font-size: 0.75rem
        white-space: nowrap
        overflow: hidden
        text-overflow: ellipsis

  .user-menu-separator
    height: 1px
    background-color: colors.$dark-gray
    margin: 0.375rem 0

  .user-menu-item
    color: colors.$white
    padding: 0.625rem 0.75rem
    cursor: pointer
    transition: background-color 0.1s ease
    border-radius: 0.5rem
    user-select: none
    display: flex
    align-items: center
    gap: 0.75rem
    font-size: 0.9rem

    .menu-icon
      width: 1.125rem
      height: 1.125rem
      flex-shrink: 0
      opacity: 0.9

    .menu-label
      flex: 1
      white-space: nowrap

    &:hover
      background-color: colors.$gray

    &.active
      background-color: colors.$gray
      
      .menu-icon
        color: colors.$primary

    &.danger
      &:hover
        background-color: colors.$error-opacity
        color: colors.$error

    &.star
      &:hover
        background-color: rgba(255, 215, 0, 0.15)
        color: #FFD700

    &.support
      &:hover
        background-color: colors.$primary-opacity
        color: colors.$primary